<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qsxh.dao.StatMapper">
	<!-- 查询性别分布数据 -->
	<select id="loadUserSexStatList" resultType="com.qsxh.entity.StatEntity">
		select usex as name,count(1) as value from tbldata
		GROUP BY usex
	</select>

	<!-- 查询VIp购买年度统计数据 -->
	<select id="loadVipBuyYearStat"
			resultType="java.lang.Double">
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'01') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'01') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'03') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'04') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'05') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'06') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'07') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'08') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'09') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'10') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'11') and atype=23
		UNION all
		select count(*)from tblaccount WHERE DATE_FORMAT(adate,"%Y%m")=CONCAT(#{value},'12') and atype=23

	</select>


	<!-- 查询新增用户年度统计数据 -->
	<select id="loadIncreaseUserYearStat" resultType="java.lang.Double">
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'01') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'02') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'03') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'04') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'05') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'06') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'07') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'08') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'09') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'10') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'11') and roleid not in (1,2)
		UNION ALL
		select count(*)from tbluser WHERE DATE_FORMAT(regdate,"%Y%m")=CONCAT(#{value},'12') and roleid not in (1,2)
	</select>


	<!--	 查询用户消费年度排行统计数据 -->
	<select id="loadUserConsumeOrderStat" resultType="com.qsxh.entity.StatEntity">
		SELECT t3.name,t3.value FROM
		(SELECT t1.userid,t2.uname as name,SUM(agold) AS value FROM tblaccount t1,tbluser t2
		WHERE DATE_FORMAT(adate,"%Y")=CONCAT(#{value})and t1.atype!=21
		and t1.userid=t2.userid GROUP BY t1.userid LIMIT 3) t3 ORDER BY value DESC
	</select>


	<!-- 查询学历分布数据 -->
	<select id="loadUserEduStat" resultType="com.qsxh.entity.StatEntity">
		SELECT uedu as name,COUNT(*) as value from tbldata GROUP BY uedu
	</select>


	<!-- 查询用户年龄段分布数据 -->
	<select id="loadUserAgeStat" resultType="com.qsxh.entity.StatEntity">
		SELECT count(*) as VALUE,'18-20' as name FROM
		(SELECT TIMESTAMPDIFF(YEAR,t1.ubirthday,CURDATE())AS age from tbldata t1) t2 where t2.age in(18,19,20)
		UNION ALL
		SELECT count(*) as VALUE,'21-23' as name FROM
		(SELECT TIMESTAMPDIFF(YEAR,t1.ubirthday,CURDATE())AS age from tbldata t1) t2 where t2.age in(21,22,23)
		UNION ALL
		SELECT count(*) as VALUE,'24-26' as name FROM
		(SELECT TIMESTAMPDIFF(YEAR,t1.ubirthday,CURDATE())AS age from tbldata t1) t2 where t2.age in(24,25,26)
		UNION ALL
		SELECT count(*) as VALUE,'27-29' as name FROM
		(SELECT TIMESTAMPDIFF(YEAR,t1.ubirthday,CURDATE())AS age from tbldata t1) t2 where t2.age in(27,28,29)
		UNION ALL
		SELECT count(*) as VALUE,'30-32' as name FROM
		(SELECT TIMESTAMPDIFF(YEAR,t1.ubirthday,CURDATE())AS age from tbldata t1) t2 where t2.age in(30,31,32)
		UNION ALL
		SELECT count(*) as VALUE,'33-35' as name FROM
		(SELECT TIMESTAMPDIFF(YEAR,t1.ubirthday,CURDATE())AS age from tbldata t1) t2 where t2.age in(33,34,35)
		UNION ALL
		SELECT count(*) as VALUE,'36-38' as name FROM
		(SELECT TIMESTAMPDIFF(YEAR,t1.ubirthday,CURDATE())AS age from tbldata t1) t2 where t2.age in(36,37,38)
		UNION ALL
		SELECT count(*) as VALUE,'39-40' as name FROM
		(SELECT TIMESTAMPDIFF(YEAR,t1.ubirthday,CURDATE())AS age from tbldata t1) t2 where t2.age in(39,40)
		UNION ALL
		SELECT count(*) as VALUE,'41以上' as name FROM
		(SELECT TIMESTAMPDIFF(YEAR,t1.ubirthday,CURDATE())AS age from tbldata t1) t2 where t2.age>40

	</select>





</mapper>