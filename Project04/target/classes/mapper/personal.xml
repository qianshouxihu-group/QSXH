<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qsxh.dao.PersonalDao">

    <!--注册完善-->
    <update id="regUpdate" parameterType="com.qsxh.entity.PersonalData">
        UPDATE tbluser t1 ,tbldata t2 SET t1.uimgurl =#{imgurl},t1.roleid =#{roleid},
        t2.usex=#{usex},t2.idcard=#{idcard},
        t2.ubirthday=#{ubirthday},t2.uwechat=#{contact},t2.uaddress=#{uaddress},
        t2.uheight=#{uheight},t2.uweight=#{uweight},t2.uedu=#{uedu},
        t2.umerried=#{umerried},t2.ublood=#{ublood},
        t2.conste=#{constellation}, t2.uincome=#{uincome},t2.realname=#{realname},
        t2.s_province=#{s_province},t2.s_city=#{s_city}
        where t1.userid = #{userid} and t1.userid =t2.userid
    </update>
    <!--基础资料查询-->
    <select id="findUserWithBasic" resultType="com.qsxh.entity.PersonalData">
        select u.roleid,u.userid,u.uname,u.upass,u.uimgurl as imgurl,d.ubirthday,d.umerried,d.uheight,d.uincome,d.uweight,d.uedu,d.usex,d.ublood,d.conste as constellation,
        d.uage,d.uaddress,d.uinstro,d.s_province,d.s_city
        from tbluser u, tbldata d where u.userid =d.userid and u.userid =#{userid}
    </select>
    <!--基础资料更新-->
    <update id="updateUserWithBasic" parameterType="com.qsxh.entity.PersonalData">
        UPDATE tbluser t1 ,tbldata t2 SET t2.umerried =#{umerried}, t2.uincome = #{uincome},t2.uedu = #{uedu},
        t2.conste = #{constellation}, t2.s_province = #{s_province},t2.s_city = #{s_city},t2.uinstro = #{uinstro},
        t1.uname=#{uname},t2.uweight =#{uweight},t2.uaddress =#{uaddress}
        WHERE t1.userid = #{userid} and t1.userid =t2.userid
    </update>
    <!--个性要求查询-->
    <select id="findDataWithLimit" resultType="com.qsxh.entity.PersonalData">
        select ureligion as religion,uchild as child,usmoke as smoke,udrink as drink,uwedding as wedding
        from tbldata where userid =#{userid}
    </select>
    <!--个性要求更新-->
    <update id="updateDataWithLimit" parameterType="com.qsxh.entity.PersonalData">
        UPDATE tbldata SET ureligion =#{religion}, uchild = #{child},usmoke = #{smoke},udrink = #{drink},
        uwedding = #{wedding}
        WHERE userid = #{userid}
    </update>
    <!--工作学习查询-->
    <select id="findDataWithWS" resultType="com.qsxh.entity.PersonalData">
        select positions,uwork,uschool,major,gradtime,ucar,uhouse
        from tbldata where userid = #{userid}
    </select>
    <!--工作学习更新-->
    <update id="updateDataWithWS" parameterType="com.qsxh.entity.PersonalData">
        UPDATE tbldata SET uschool =#{uschool}, positions = #{positions},ucar = #{ucar},uhouse = #{uhouse},
        gradtime = #{gradtime},major =#{major},uwork = #{uwork}
        WHERE userid = #{userid}
    </update>
    <!--头像更新-->
    <update id="updateUserWithHeadImg" parameterType="com.qsxh.entity.ImageReturn">
        UPDATE tbluser SET uimgurl = #{imgurl}
        WHERE userid = #{userid}
    </update>
    <!--修改用户密码-->
    <update id="updateUserWithPass" >
        UPDATE tbluser SET upass = #{upass}
        WHERE userid = #{userid}
    </update>

    <!--不带地址的基础资料更新    -->
    <update id="updateBasicWithoutAddress" parameterType="com.qsxh.entity.PersonalData">
        UPDATE tbluser t1 ,tbldata t2 SET t2.umerried =#{umerried}, t2.uincome = #{uincome},t2.uedu = #{uedu},
        t2.conste = #{constellation},t2.uinstro = #{uinstro},
        t1.uname=#{uname},t2.uweight =#{uweight},t2.uage =#{uage}
        WHERE t1.userid = #{userid} and t1.userid =t2.userid
    </update>

    <!--修改用户密码-->
    <update id="updatePass">
        UPDATE tbluser SET upass = #{upass} where userid = #{userid}
    </update>


</mapper>

